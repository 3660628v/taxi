<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Taxi fares from 5 April 2014</title>
		<!-- CSS for 3 columns -->
		<style>
			.column-full {
				text-align: center;
				width: 100%;
				font-size: 20px;
			}
			.column-left {
				float: left;
				width: 33%;
			}
			.column-right {
				float: right;
				width: 33%;
			}
			.column-center {
				display: inline-block;
				width: 33%;
			}
		</style>
	</head>
	<body>
		<!-- Tariff 1 column -->
		<div class="column-full">
			<span id="current_tariff"></span>
		</div>
		<!-- Tariff 1 column -->
		<div class="column-left">
			<b>Tariff 1 (Monday to Friday 6am - 8pm)</b><br/><br/>
			<span id="tariff_1"></span>
		</div>
		<!-- Tariff 2 column -->
		<div class="column-center">
			<b>Tariff 2 (Monday to Friday 8pm - 10pm) &amp; (Saturday and Sunday 6am - 10pm)</b><br/><br/>
			<span id="tariff_2"></span>
		</div>
		<!-- Tariff 3 column -->
		<div class="column-right">
			<b>Tariff 3 (Every night 10pm - 6am; Public holidays)</b><br/><br/>
			<span id="tariff_3"></span>
		</div>
		<script>
			
			// Date object
			var d = new Date();
			
			// If you need to test other days, hours, not current, uncomment code and change year, month, day & hour
			// Default value on example: 4 May of 2015 (Early May bank holiday) Tariff 3
			
			/*
			d.setFullYear(2015); // Year
			d.setMonth(3) // Month
			d.setDate(4); // Day
			d.setHours(20); // Hour
			*/
			
			// Returns the year (four digits)
			var getFullYear = d.getFullYear();
			
			// Returns the month (from 0-11)
			var getMonth = d.getMonth();
			
			// Returns the day of the week (from 0-6)
			var getDay = d.getDay();
			
			// Returns the hour (from 0-23)
			var getHours = d.getHours();
			
			// Tariff 1 (Monday to Friday 6am - 8pm)
			if(getDay >= 1 && getDay <= 5 && getHours >= 6 && getHours < 20) {
				var tariff = 1;
			}
			// Tariff 2 (Monday to Friday 8pm - 10pm)
			if(getDay >= 1 && getDay <= 5 && getHours >= 20 && getHours < 22) {
				var tariff = 2;
			}
			// Tariff 2 (Saturday and Sunday 6am - 10pm)
			if(getDay == 6 || getDay == 0 && getHours >= 6 && getHours < 22) {
				var tariff = 2;
			}
			// Tariff 3 (Every night 10pm - 6am)
			if(getHours >= 22 && getHours <= 23 || getHours >= 0 && getHours < 6) {
				var tariff = 3;
			}
			// Tariff 3 (Public holidays)
			
			/*
			https://www.gov.uk/bank-holidays
			
			2014
			25 December		Thursday	Christmas Day
			26 December		Friday		Boxing Day
			
			2015
			1 January		Thursday	New Year’s Day
			3 April			Friday		Good Friday
			6 April			Monday		Easter Monday
			4 May			Monday		Early May bank holiday
			25 May			Monday		Spring bank holiday
			31 August		Monday		Summer bank holiday
			25 December		Friday		Christmas Day
			28 December		Monday		Boxing Day (substitute day)
			
			2016
			1 January		Friday		New Year’s Day
			25 March		Friday		Good Friday
			28 March		Monday		Easter Monday
			2 May			Monday		Early May bank holiday
			30 May			Monday		Spring bank holiday
			29 August		Monday		Summer bank holiday
			26 December		Monday		Boxing Day
			27 December		Tuesday		Christmas Day (substitute day)
			*/
			
			// Christmas Day
			if(getFullYear == 2014 && getMonth == 11 && getDay == 25) {
				var tariff = 3;
			}
			// Boxing Day
			if(getFullYear == 2014 && getMonth == 11 && getDay == 26) {
				var tariff = 3;
			}
			// New Year’s Day
			if(getFullYear == 2015 && getMonth == 0 && getDay == 1) {
				var tariff = 3;
			}
			// Good Friday
			if(getFullYear == 2015 && getMonth == 3 && getDay == 3) {
				var tariff = 3;
			}
			// Easter Monday
			if(getFullYear == 2015 && getMonth == 3 && getDay == 6) {
				var tariff = 3;
			}
			// Early May bank holiday
			if(getFullYear == 2015 && getMonth == 4 && getDay == 4) {
				var tariff = 3;
			}
			// Spring bank holiday
			if(getFullYear == 2015 && getMonth == 4 && getDay == 25) {
				var tariff = 3;
			}
			// Summer bank holiday
			if(getFullYear == 2015 && getMonth == 6 && getDay == 31) {
				var tariff = 3;
			}
			// Christmas Day
			if(getFullYear == 2015 && getMonth == 11 && getDay == 25) {
				var tariff = 3;
			}
			// Boxing Day (substitute day)
			if(getFullYear == 2015 && getMonth == 11 && getDay == 28) {
				var tariff = 3;
			}
			// New Year’s Day
			if(getFullYear == 2016 && getMonth == 0 && getDay == 1) {
				var tariff = 3;
			}
			// Good Friday
			if(getFullYear == 2016 && getMonth == 2 && getDay == 25) {
				var tariff = 3;
			}
			// Easter Monday
			if(getFullYear == 2016 && getMonth == 2 && getDay == 28) {
				var tariff = 3;
			}
			// Early May bank holiday
			if(getFullYear == 2016 && getMonth == 4 && getDay == 2) {
				var tariff = 3;
			}
			// Spring bank holiday
			if(getFullYear == 2016 && getMonth == 4 && getDay == 30) {
				var tariff = 3;
			}
			// Summer bank holiday
			if(getFullYear == 2016 && getMonth == 6 && getDay == 29) {
				var tariff = 3;
			}
			// Boxing Day
			if(getFullYear == 2016 && getMonth == 11 && getDay == 26) {
				var tariff = 3;
			}
			// Christmas Day (substitute day)
			if(getFullYear == 2016 && getMonth == 11 && getDay == 28) {
				var tariff = 3;
			}
			
			var current_tariff = document.getElementById('current_tariff');
			current_tariff.innerHTML = d + '<br/><br/>Current tariff: <b style="color:#ff0000">' + tariff + '</b><br/><br/>';
			
			// Generate 0 - 60 minutes loop to test each tariff
			for (var i = 0; i <= 60; i++) {
				
				if(tariff === 1) {
					color1_1 = '<span style="color:#ff0000">';
					color1_2 = '</span>';
				}
				else {
					color1_1 = '<span style="color:#000">';
					color1_2 = '</span>';
				}
				if(tariff === 2) {
					color2_1 = '<span style="color:#ff0000">';
					color2_2 = '</span>';
				}
				else {
					color2_1 = '<span style="color:#000">';
					color2_2 = '</span>';
				}
				if(tariff === 3) {
					color3_1 = '<span style="color:#ff0000">';
					color3_2 = '</span>';
				}
				else {
					color3_1 = '<span style="color:#000">';
					color3_2 = '</span>';
				}
				
				// Tariff 1 (Monday to Friday 6am - 8pm)
				var tariff_1 = document.getElementById('tariff_1');
				tariff_1.innerHTML = color1_1 + tariff_1.innerHTML + i + ' min = £' + price(i, 1) + color1_2 + '<br/>';
				
				// Tariff 2 (Monday to Friday 8pm - 10pm; Saturday and Sunday 6am - 10pm)
				var tariff_2 = document.getElementById('tariff_2');
				tariff_2.innerHTML = color2_1 + tariff_2.innerHTML + i + ' min = £' + price(i, 2) + color2_2 + '<br/>';
				
				// Tariff 3 (Every night 10pm - 6am; Public holidays)
				var tariff_3 = document.getElementById('tariff_3');
				tariff_3.innerHTML = color3_1 + tariff_3.innerHTML + i + ' min = £' + price(i, 3) + color3_2 + '<br/>';
			}
			
			/*
			Function to get price, required variables:
				var time 	= current time in minutes
				var tariff 	= current tariff
			*/
			
			function price(time, tariff) {
				
				// There is a minimum fare of £2.40 at all times
				var minimum = 2.40;
				
				// Tariff 1 (Monday to Friday 6am - 8pm)
				if(tariff === 1) {
					
					// Check if current journey time is less than 6 minutes
					if(time < 6) {
						// 0 - 6 minutes journey with price from £2.40 (minimum fare) to £5.60
						return calculate(minimum, time, 0, 6, 2.40, 5.60);
					}
					
					// 6 - 13 minutes journey with price from £5.60 to £8.80
					if(time >= 6 && time <= 13) {
						return calculate(minimum, time, 6, 13, 5.60, 8.80);
					}
					
					// 10 - 20 minutes journey with price from £8.60 to £13.80
					if(time >= 10 && time <= 20) {
						return calculate(minimum, time, 10, 20, 8.60, 13.80);
					}
					
					// 16 - 30 minutes journey with price from £15.00 to £22.00
					if(time >= 16 && time <= 30) {
						return calculate(minimum, time, 16, 30, 15.00, 22.00);
					}
					
					// 28 - 40 minutes journey with price from £23.00 to £29.00
					if(time >= 28 && time <= 40) {
						return calculate(minimum, time, 28, 40, 23.00, 29.00);
					}
					
					// 30 - 60 minutes journey with price from £46.00 to £85.00
					if(time >= 30 && time <= 60) {
						return calculate(minimum, time, 30, 60, 46.00, 85.00);
					}
					
				}
				
				// Tariff 2 (Monday to Friday 8pm - 10pm; Saturday and Sunday 6am - 10pm)
				if(tariff === 2) {
					
					// Check if current journey time is less than 6 minutes
					if(time < 6) {
						// 0 - 6 minutes journey with price from £2.40 (minimum fare) to £5.60
						return calculate(minimum, time, 0, 6, 2.40, 5.60);
					}
					
					// 6 - 13 minutes journey with price from £5.60 to £9.00
					if(time >= 6 && time <= 13) {
						return calculate(minimum, time, 6, 13, 5.60, 9.00);
					}
					
					// 10 - 20 minutes journey with price from £9.00 to £14.00
					if(time >= 10 && time <= 20) {
						return calculate(minimum, time, 10, 20, 9.00, 14.00);
					}
					
					// 16 - 30 minutes journey with price from £16.00 to £22.00
					if(time >= 16 && time <= 30) {
						return calculate(minimum, time, 16, 30, 16.00, 22.00);
					}
					
					// 28 - 40 minutes journey with price from £28.00 to £32.00
					if(time >= 28 && time <= 40) {
						return calculate(minimum, time, 28, 40, 28.00, 32.00);
					}
					
					// 30 - 60 minutes journey with price from £46.00 to £85.00
					if(time >= 30 && time <= 60) {
						return calculate(minimum, time, 30, 60, 46.00, 85.00);
					}
				}
				
				// Tariff 3 (Every night 10pm - 6am; Public holidays)
				if(tariff === 3) {
					
					// Check if current journey time is less than 6 minutes
					if(time < 6) {
						// 0 - 6 minutes journey with price from £2.40 (minimum fare) to £6.80
						return calculate(minimum, time, 0, 6, 2.40, 6.80);
					}
					
					// 6 - 13 minutes journey with price from £6.80 to £9.00
					if(time >= 6 && time <= 13) {
						return calculate(minimum, time, 6, 13, 6.80, 9.00);
					}
					
					// 10 - 20 minutes journey with price from £10.40 to £14.80
					if(time >= 10 && time <= 20) {
						return calculate(minimum, time, 10, 20, 10.40, 14.80);
					}
					
					// 16 - 30 minutes journey with price from £18.00 to £28.00
					if(time >= 16 && time <= 30) {
						return calculate(minimum, time, 16, 30, 18.00, 28.00);
					}
					
					// 28 - 40 minutes journey with price from £28.00 to £33.00
					if(time >= 28 && time <= 40) {
						return calculate(minimum, time, 28, 40, 28.00, 33.00);
					}
					
					// 30 - 60 minutes journey with price from £46.00 to £85.00
					if(time >= 30 && time <= 60) {
						return calculate(minimum, time, 30, 60, 46.00, 85.00);
					}
				}
			}
			
			/*
			Function to calculate price, required variables:
				var minimum 	= minimum fare at all times (£2.40 at this time)
				var time 		= current journey time
				
				var time_from 	= time interval (from)
				var time_to 	= time interval (to)
				
				var price_from 	= price interval (from)
				var price_to 	= price interval (to)
			*/
			function calculate(minimum, time, time_from, time_to, price_from, price_to) {
				
				// ...
				var mid_price = (((price_to) - (price_from)) / ((time_to - time_from) - time_from));
				
				// ...
				if(time == time_from) {
					var variable_new = ((((price_from - minimum) / time_from) * time) + minimum);
				}
				
				// Check if current journey time is less than 6 minutes
				if(time < 6) {
					
					// Check if current journey is 0 minutes, just starts. Minimum fare at all times apply
					if(time == 0) {
						var variable_new = minimum;
					}
					
					// Check if current journey time is more than 0 minutes, but less than 6 minutes
					else {
						
						// Calculate
						var variable_new = ((((price_from + (((price_to - price_from) / (time_to - time_from)) * (time - time_from) ) - minimum) / (time_from + (time - time_from)) * time)) + minimum);
					}
				}
				
				// Check if current journey time is more than 6 minutes
				else {
					
					// Check if current journey time is more than minumum value of time interval
					if(time > time_from) {
						
						// Calculate
						var variable_new = ((((price_from + (((price_to - price_from) / (time_to - time_from)) * (time - time_from) ) - minimum) / (time_from + (time - time_from)) * time)) + minimum);
					}
				}
				
				// Round price to 2 decimal places
				variable_new = parseFloat(Math.round(variable_new * 100) / 100).toFixed(2);
				
				/*
					If instead of 'return' would use 'append', there would be more values returned.
					It would happen because some of time intervals are merging (it still would calculate price correctly).
					
					It's possible to add some more additional calculations if we would have current distance
					
					i.e. 
					6 - 13 minutes (1 mile) with tariff £5.60 - £8.80
					10 - 20 minutes (2 miles) with tariff £8.60 - £13.80
					
					10 - 13 minutes is merged, but if we would know, that it's 2 miles journey, we would use £8.60 - £13.80 tariff for this merged time interval.
					In this case we use £5.60 - £8.80, because we are not checking distance.
					There are big jumps of price in some cases because of that, but it's still fits 'Taxi fares from 5 April 2014'
				*/
				
				// Return current price
				return variable_new;
			}
			
		</script>
	</body>
</html>